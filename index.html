<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoArt AI - Web Edition</title>
    <style>
        /* --- ESTILO WEB MODERNO --- */
        :root { --bg: #0f172a; --panel: #1e293b; --accent: #8b5cf6; --text: #f8fafc; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; overflow: hidden; }
        
        /* Layout Responsivo */
        .sidebar { width: 280px; background: var(--panel); padding: 20px; display: flex; flex-direction: column; gap: 15px; border-right: 1px solid #334155; box-shadow: 2px 0 10px rgba(0,0,0,0.3); z-index: 10; }
        .main { flex: 1; position: relative; background: #000; display: flex; justify-content: center; align-items: center; background-image: radial-gradient(circle at center, #1a1a1a 0%, #000 100%); }
        
        h2 { margin: 0 0 5px 0; font-size: 1.5rem; background: linear-gradient(to right, #c084fc, #38bdf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        p.subtitle { margin: 0 0 20px 0; font-size: 0.8rem; color: #94a3b8; }
        
        /* Bot√µes */
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; color: white; font-weight: 600; transition: all 0.2s; margin-bottom: 8px; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 8px; }
        button:hover { transform: translateY(-2px); filter: brightness(1.1); }
        button:active { transform: translateY(0); }
        
        .btn-ai { background: linear-gradient(135deg, #a855f7, #ec4899); box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3); }
        .btn-search { background: #3b82f6; }
        .btn-rand { background: #f59e0b; }
        .btn-dl { position: absolute; bottom: 25px; right: 25px; width: auto; padding: 12px 25px; background: #10b981; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); border-radius: 30px; }

        /* Inputs e Pain√©is */
        .input-group { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; border: 1px solid #334155; margin-bottom: 10px; display: none; animation: slideDown 0.3s ease; }
        input { width: 100%; padding: 10px; background: #0f172a; border: 1px solid #475569; color: white; border-radius: 6px; margin-bottom: 10px; outline: none; }
        input:focus { border-color: var(--accent); }
        
        @keyframes slideDown { from{opacity:0; transform:translateY(-10px);} to{opacity:1; transform:translateY(0);} }

        /* Overlay de Carregamento */
        #loader { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 50; backdrop-filter: blur(5px); }
        .spinner { width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.1); border-left-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Canvas */
        canvas { max-width: 100%; max-height: 100%; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

    <div class="sidebar">
        <div>
            <h2>GeoArt AI</h2>
            <p class="subtitle">Vers√£o Web (GitHub)</p>
        </div>
        
        <button class="btn-ai" onclick="openPanel('ai')">‚ú® Criar com IA</button>
        <div id="panel-ai" class="input-group">
            <input type="text" id="aiInput" placeholder="Ex: Cyberpunk city neon..." onkeypress="handleEnter(event, runAI)">
            <button class="btn-ai" onclick="runAI()">Gerar Arte</button>
        </div>

        <button class="btn-search" onclick="openPanel('search')">üîç Buscar Foto</button>
        <div id="panel-search" class="input-group">
            <input type="text" id="searchInput" placeholder="Ex: Montanha, Praia..." onkeypress="handleEnter(event, runSearch)">
            <button class="btn-search" onclick="runSearch()">Pesquisar</button>
        </div>

        <button class="btn-rand" onclick="runRandom()">üé≤ Aleat√≥rio</button>
        
        <div style="margin-top: auto; border-top: 1px solid #334155; padding-top: 15px;">
            <label style="display: flex; align-items: center; cursor: pointer; gap: 10px; color: #cbd5e1; font-size: 0.9rem;">
                <input type="checkbox" id="chkEvo" checked style="width:auto; margin:0;">
                Modo Evolutivo
            </label>
        </div>
    </div>

    <div class="main">
        <canvas id="artCanvas"></canvas>
        <button class="btn-dl" onclick="downloadArt()">üíæ Baixar HD</button>
        
        <div id="loader">
            <div class="spinner"></div>
            <p id="statusText" style="margin-top: 15px; color: #e2e8f0;">Iniciando...</p>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ÉO
        const canvas = document.getElementById('artCanvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const config = { width: 1920, height: 1080 };
        
        let isRunning = false;
        let imgData = null; // Guarda os pixels da imagem
        
        function init() {
            canvas.width = config.width;
            canvas.height = config.height;
            // Come√ßa com uma imagem bonita
            processUrl("https://picsum.photos/1920/1080", "Iniciando sistema...");
        }

        // --- SISTEMA DE IMAGEM PARA WEB (HTTPS) ---
        // Funciona perfeito no GitHub Pages
        function processUrl(url, msg) {
            setLoading(true, msg);
            isRunning = false;

            const img = new Image();
            img.crossOrigin = "Anonymous"; // O Segredo do GitHub Pages
            
            img.onload = () => {
                // Desenha num canvas invis√≠vel para extrair cores
                const off = document.createElement('canvas');
                off.width = config.width; off.height = config.height;
                const offCtx = off.getContext('2d');
                
                // Centraliza e corta (Cover)
                const r = Math.max(config.width/img.width, config.height/img.height);
                const w = img.width*r, h = img.height*r;
                offCtx.drawImage(img, (config.width-w)/2, (config.height-h)/2, w, h);
                
                try {
                    imgData = offCtx.getImageData(0,0, config.width, config.height).data;
                    startAnimation();
                } catch(e) {
                    setLoading(true, "Erro de Seguran√ßa. Tente recarregar.");
                }
            };
            
            img.onerror = () => {
                setLoading(true, "Erro ao baixar imagem. Tentando outra...");
                setTimeout(() => runRandom(), 2000);
            };

            // Adiciona timestamp para n√£o cachear
            if(url.includes('?')) img.src = url + "&t=" + Date.now();
            else img.src = url + "?t=" + Date.now();
        }

        function startAnimation() {
            setLoading(false);
            // Pinta fundo preto
            ctx.fillStyle = "#000";
            ctx.fillRect(0, 0, config.width, config.height);
            isRunning = true;
            requestAnimationFrame(drawLoop);
        }

        function drawLoop() {
            if(!isRunning) return;
            
            // Desenha v√°rias formas por quadro (Velocidade)
            const speed = 60; 
            const evolution = document.getElementById('chkEvo').checked;

            for(let i=0; i<speed; i++) {
                const x = Math.floor(Math.random() * config.width);
                const y = Math.floor(Math.random() * config.height);
                const idx = (y * config.width + x) * 4;
                
                const r = imgData[idx];
                const g = imgData[idx+1];
                const b = imgData[idx+2];
                
                // Ignora preto quase total
                if(r < 10 && g < 10 && b < 10) continue;

                ctx.fillStyle = `rgb(${r},${g},${b})`;
                ctx.beginPath();
                
                // Tamanho din√¢mico
                let size = Math.random() * 30 + 4;
                if(evolution) size = Math.random() * 50 + 2;

                if(Math.random() > 0.5) {
                    ctx.arc(x, y, size/2, 0, Math.PI*2);
                    ctx.fill();
                } else {
                    ctx.fillRect(x - size/2, y - size/2, size, size);
                }
            }
            requestAnimationFrame(drawLoop);
        }

        // --- FUN√á√ïES DE CONTROLE ---
        function runAI() {
            const txt = document.getElementById('aiInput').value;
            if(!txt) return;
            // Pollinations Direto (Funciona no GitHub)
            const seed = Math.floor(Math.random() * 99999);
            // Usamos modelo Flux e tamanho HD
            const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(txt)}?width=1280&height=720&model=flux&nologo=true&seed=${seed}`;
            processUrl(url, "IA Criando Arte...");
        }

        function runSearch() {
            const txt = document.getElementById('searchInput').value;
            if(!txt) return;
            // LoremFlickr Direto
            const url = `https://loremflickr.com/1280/720/${encodeURIComponent(txt)}`;
            processUrl(url, "Buscando Imagem...");
        }

        function runRandom() {
            processUrl(`https://picsum.photos/1280/720`, "Sorteando...");
        }

        // UI
        function openPanel(id) {
            document.querySelectorAll('.input-group').forEach(el => el.style.display = 'none');
            const el = document.getElementById('panel-'+id);
            if(el) el.style.display = 'block';
        }
        
        function setLoading(show, msg) {
            const el = document.getElementById('loader');
            el.style.display = show ? 'flex' : 'none';
            if(msg) document.getElementById('statusText').innerText = msg;
        }

        function downloadArt() {
            const a = document.createElement('a');
            a.download = 'GeoArt-HD.png';
            a.href = canvas.toDataURL('image/png');
            a.click();
        }
        
        function handleEnter(e, func) { if(e.key === 'Enter') func(); }

        init();
    </script>
</body>
</html>
